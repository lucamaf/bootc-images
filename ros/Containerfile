FROM registry.redhat.io/rhel9/rhel-bootc:9.6 

ENV LANG=en_US.UTF-8

# Package dependencies for building
RUN dnf install -y curl dnf-plugins-core langpacks-en glibc-langpack-en \
    'dnf-command(config-manager)' \
    https://dl.fedoraproject.org/pub/epel/epel-release-latest-$(rpm -E %rhel).noarch.rpm && \
    dnf config-manager --set-enabled codeready-builder-for-rhel-$(rpm -E %rhel)-$(arch)-rpms && \
    dnf clean all

RUN dnf install -y "https://github.com/ros-infrastructure/ros-apt-source/releases/download/$(curl -s https://api.github.com/repos/ros-infrastructure/ros-apt-source/releases/latest | grep -F "tag_name" | awk -F\" '{print $4}')/ros2-release-$(curl -s https://api.github.com/repos/ros-infrastructure/ros-apt-source/releases/latest | grep -F "tag_name" | awk -F\" '{print $4}')-1.noarch.rpm"

# Development tools (optional)
#RUN dnf install -y \
#        cmake \
#        gcc-c++ \
#        git \
#        make \
#        patch \
#        python3-colcon-common-extensions \
#        python3-mypy \
#        python3-pip \
#        python3-pytest \
#        python3-rosdep \
#        python3-setuptools \
#        python3-vcstool \
#        wget && \
#    python3 -m pip install -U --user \
#        flake8-blind-except==0.1.1 \
#        flake8-class-newline \
#        flake8-deprecated && \
#    dnf clean all

RUN tee /etc/yum.repos.d/ros2.repo <<'EOF'
[ros2]
name=ROS 2
baseurl=http://packages.ros.org/ros2/rhel/9/$basearch
enabled=1
gpgcheck=0
releasever=9
EOF

RUN dnf install -y ros-kilted-desktop
